# Лабораторная работа 16: Ответ без ввода новой строки.

#### Задание:
Напишите программу, которая печатает вопрос и требует односимвольного ответа. Измените атрибуты вашего терминала так, чтобы пользователю не нужно было вводить новую строку после ответа.

#### Ход выполнения:
В первую очередь, нам понадобится структура **termios**, которая описывает  общий терминальный интерфейс, гарантирующий управление асинхронным коммуникационным портом.

Данная структура содержит, как минимум, следующие элементы:

* ```tcflag_t c_iflag;``` - режимы ввода
* ```tcflag_t c_oflag;``` - режимы вывода
* ```tcflag_t c_cflag;``` - режимы управления
* ```tcflag_t c_lflag;``` - режимы локали
* ```cc_t c_cc[NCCS];```  - управляющие символы
* c_iflag - флаги констант:

С помощью ```int tcgetattr(int fd, struct termios *termios_p);``` получаем атрибуты дескриптора **fd** (в нашем случае это стандартный ввод) и сохраняем их в предварительно подготовленный ```struct termios attributes;```. На этом этапе мы получили текущие артибуты терминала, их надо сохранить для восстановления в конце программы, делаем это: ```tmpAttributes = attributes;```. Теперь меняем атрибуты для нужной нам задачи: ```attributes.c_lflag &= ~(ICANON | ECHO);``` - используем неканоничный режим и не выводим введенный символ.

> Каноничный режим (ICANON) означает, что линии используют специальные символы: EOF, EOL, EOL2, ERASE, KILL, LNEXT, REPRINT, STATUS и WERASE, а также строчную буферизацию, нам это не нужно, вывод введенных символов (ECHO) нам тоже не нужен. ICANON, ECHO и т.д. определяются как макросы, их можно всячески комбинировать, складывать, исключать и так далее, смотря какой режим нам нужен.

Далее используем ```attributes.c_cc[VMIN] = 1;```, т.е. даем информацию, что у нас один не неканоничный символ.

> Не знаю для чего это, видимо обязательная информация для системы, без этого не работает.

Теперь наша структура ```struct termios attributes;``` хранит готовые артибуты для нашей задачи, надо их задать для стандартного ввода с помощью ```int tcsetattr(int fd, int optional_actions, struct termios *termios_p);```, которая меняет параметры, связанные с терминалом (если требуется поддержка используемого оборудования, которая недоступна), и параметры структуры termios, связанной с termios_p. В качестве **fd** передается **STDIN_FILENO**, второй параметр - то, от чего зависит, как и когда изменения будут вступать в силу. В нашем случае он равен **TCSAFLUSH**, т.е. изменения начинают работу после того, как на объект, на который указывает fd, были переданы все данные, предназначенные для вывода на запись; все данные, которые были приняты (но не считаны), будут отменены перед тем, как произошли изменения. После этого вызова наш стандартный ввод настроен на чтение без символа новой строки (неканоничный режим) и не выводит введенный символ (чтобы не мусорить), третий параметр - наша подготовленная структура с атрибутами.

Теперь в цикле **while** программа просит ввести какую-нибудь букву. Программа считывает через **read**, который читает из **STDIN_FILENO** в буфер, который является переменной типа **char**. После идет проверка введенного символа через функцию **isalpha**, которая возвращает число, отличное от нуля, если переданный ей элемент является буквой в верхнем или нижнем регистре. Если функция вернула число, отличное от нуля, программа выводит сообщение и завершается, в противном случае программа выводит другое сообщение и переходит на следующую итерацию цикла. Цикл повторяется до тех пор, пока мы не введем букву.

Программа выполнила сваю задачу и остается восстановить атрибуты терминала на те, которые были до вызова нашей программы. Для этого мы сохраняли их в самом начале программы в **tmpAttributes**. Делаем восстановление через ```tcsetattr(STDIN_FILENO, TCSAFLUSH, &tmpAttributes)```, этот вызов мы уже разобрали.

> Было бы неправильно оставлять терминал с нашими кастомными настройками, потому что с терминалом в таком виде невозможно нормально работать и мы можем попортить пользователю терминал, а он даже не будет знать как это исправить, поэтому восстановили на дефолтные.
