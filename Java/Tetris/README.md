# Тетрис

###### Общая информация

Игра выполнена почти как классический тетрис, однако здесь очки начисляются просто за линии, с числом очков скорость падения блоков не увеличивается и время не считается. При запуске вы увидите окно, в котором можно ввести своё имя (в фиолетовом окне нажать правой кнопкой мыши и писать, это просто TextField, по умолчанию имя Player), ниже имени кнопка для запуска игры. Слева внизу кнопка для завершения работы программы. Справа внизу кнопка для помощи (там краткая инструкция куда нажимать для управления во время игры), чтобы выйти из меню помощи, надо нажать мышкой в любое место на экране (там это тоже написано внизу). Когда нажимается кнопка Play, текущий графический элемент, то есть меню, делается невидимым и вместо него добавляется на основной графический элемент (Window) уже графический элемент с игровым полем. Меню игры и игровое поле представляют собой отдельные классы, которые унаследованы от JPanel и реализуют нужные им интерфейсы. Например, для меню не нужно имплементировать интерфейс слушателя клавиатуры, так как в этом меню всё делается мышкой, а вот на самом игровом поле нужна как мышка, так и кнопки. Важно отметить, что игровое поле отрисовывается в цикле с FPC 60 (там в классе Board поле FPC), а меню перерисовывается только когда что-нибудь происходит (то есть метод перерисовки вызывается при событии нажатии какой-нибудь кнопки), это немного экономит ресурсы. Кнопки хотел сделать так, как делают в мобильных играх - "живые", которые немного увеличиваются и шевелятся, когда на них нажимают и возвращают свой обратный размер, когда их отпускают, однако в Swing это сложно реализуется, я сделал Rectangle как коллижн модель, которая по размеру ровно такая же, как и картинка для нее (использовал методы взятия ширины и высоты картинки). Когда мышка нажимается, на это событие boolean переменная leftClick становится true, далее с помощью метода contains(x, y), где x и y - это координаты мыши можно понять в каком именно месте нажата мышь и если она нажата в области коллижн модели какой-то кнопки, то эта кнопка срабатывает, так они у меня и работают. На практике размеры почему-то не соответствуют и я подобрал примерно, также не получается сделать автоматический размер окна в зависимости от разрешения и чтобы окно можно было корректно менять. Предполагаю, что Swing не предназначатся для написания игр, он же всё-таки для апплетов в браузере. В целом, за исключением неудобства работы с графикой (опять же сравнивая со всякими Unity и более современными графическими библиотеками Java) всё получилось нормально. Во время игры можно нажать паузу и перезапустить игру (очки сбросятся и все начнется заново), но нажимать кнопки можно не чаще чем раз в секунду (для того, чтобы не зажималать кнопка перезапуска и игра постоянно перезапускалась). Также можно вернуться в главное меню на кнопку Home (переключение между окнами работает по тому же принципу, что я описал ранее). При завершении каждой партии в csv-файл в директории с игрой сохраняются результаты: имя, число очков и дата. Кода очень много и пояснить каждый момент будет затруднительно, но в коде старался оставить комментарии на интересных моментах.

### Model

###### Shape

Класс фигуры. Ему в конструктор из игрового поля передается его тип, цвет и само поле, чтобы фигура могла определять, может ли она в конкретном месте вращаться, достигла ли она дна и другое. Фигура сама знает свои координаты и сама опускает себя вниз по таймеру. Она сама удаляет ту часть себя, которая сложена в линии на поле, сама себя поворачивает с помощью матрицы поворотов и при этом проверяет, не врезалась ли она куда-нибудь. В этом классе много геттеров и методов, которые заставляют фигуру что-нибудь делать с собой (ускоряться, вращаться и т.д.), так как требуется над каждой фигурой проводить много манипуляций извне. Я так понял, в задании моделью должна быть именно фигура, по её данным уже поле её отрисовывает.

### View

###### Title

Класс-меню. В нем нет ничего сложного, в основном обрабатывает события на нажатие мыши и проверяет, находится ли мышь на какой-нибудь кнопке в момент нажатия или не находится. В нем хранятся прямоугольники-коллижн модели, имена картинок из файлов ресурсов (при создании в конструкторе по этим именам подгружаются картинки из ресурсов). Также здесь есть активный слушатель на таймер, он нужен чтобы кнопка не зажималась в цикле и было возможно на нее нажать только раз в секунду.

###### Board

Включает в себя те же принципы, что и Title (в нем же тоже кнопки, которые что-то делают), но при этот перерисовывается в цикле и постоянно обновляется. Хранит в себе поле - массив int 20*10, хранит все возможные формы фигурок тетриса (массив shapes заполняется в конструкторе), ещё важно отметить, что хранится сразу два объета shape - ближайший и следующий. Это фигура, которая сейчас летит и фигура, которая будет следующей. В оригинальном тетрисе вроде так сделано, то есть следующая фигура известна заранее. Также есть два таймера - один для кнопок, второй для отрисовки. Это поле занимается отрисовкой самого себя и всех элементов в нем.

### Controller

###### Window

Этот класс необходим для создания самой рамки, в которой отрисовывается игра. В нем созданы методы, которые нужны для переключения (через скрытие одного графического элемента и отрисовку другого), также в нем хранятся константы с шириной и высотой окна (нужны в других классах иногда) и сами классы меню и игрового поля, между которыми идет переключение.

###### CsvWriter и ImageLoader

Вспомогательные классы для работы с ресурсами - для загрузки изображений и сохранения результатов игры в таблицу.
